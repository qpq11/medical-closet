# medical-closet
Проект по предмету ПЦП (ФРКТ 4 семестр, 2025 г.)
## Цель проекта
Создать устройство, позволяющее автоматизировать процесс хранения лекарств
## Задачи
* реализовать трёхзвенную модель архитектуры (интерфейс - HTML, CSS; бизнес-логика - PHP; база данных - mysql) 
* подобрать электронные компонентов
* реализовать устройство на макетной плате
* спроектровать корпус устройства в SolidWorks
* вырезать все грани корпуса на лазере
## Функционал устройства
Данный проект представляет собой медицинский шкаф, позволяющий автоматизировать процесс хранения лекарств. Чтобы добавить лекарство в шкаф, пользователь должен ввести пароль, срок годности лекарства, номер заполняемой ячейки, штрихкод (можно внести с помощью сканера штрих кодов) на веб-страничке <ins> http://host_ip/index.html</ins> и нажать кнопку "Подтвердить". Для удаления лекарства нужно нажать кнопку "Удалить лекарство", на открывшейся страничке указать, из какой ячейки оно будет извлечено.

Чтобы проверить, забирал ли кто-либо лекарство из ячейки, не создавая соответствующую запись, можно нажать кнопку "Проверить целостность". На открывшейся страничке ввести номер интересующей ячейки. Если изменение содержимого было произведено недетерминированно, появится сообщение, уведомляющее об этом, иначе - о целостности содержимого ячейки.  

Если в какой-либо ячейке появится просроченное лекарство, то в ней замигает светодиод. Это будет продолжаться до тех пор, пока просроченное лекарство не будет извлечено.

В шкаф встроен датчик температуры, данные с которого отображаются на дисплее,   
## Описание решения поставленных задач
Для разработки ПО была выбрана трёхзвенная модель архитектуры: в качестве интерфейса используется HTML веб-форма (файл [index.html](https://github.com/qpq11/medical-closet/blob/main/index.html)), через которую осуществляется ввод данных пользователем. Имеются поля, в которые можно вводить данные о пользователе и лекарстве. При нажатии кнопки <ins>Подтвердить</ins>, данные отправляются методом POST, обрабатываются скриптом [insert.php](https://github.com/qpq11/medical-closet/blob/main/insert.php), с помощью запроса mysql данные из формы вставляются в таблицу <ins>project_base</ins> БД. При нажатии кнопки <ins>удалить лекарство</ins> происходит переход на страницу [delete_form.html](https://github.com/qpq11/medical-closet/blob/main/delete_form.html), данные из веб-формы с информацией об удаляемом лекарстве обрабатываются с помощью [delete.php](https://github.com/qpq11/medical-closet/blob/main/delete.php), соответствующая запись будет удаляется из базы данных при вводе правильного пароля (проверка в [delete.php](https://github.com/qpq11/medical-closet/blob/main/delete.php)). При попытке ввода неверного пароля 3 раза подряд происходит перенаправление на страницу блокировки [blocked.html](https://github.com/qpq11/medical-closet/blob/main/blocked.html) на 60 с, по истечении которых формы ввода и удаления станут вновь доступны (отказ доступа обеспечивает скрипт [check_block.php](https://github.com/qpq11/medical-closet/blob/main/check_block.php)). 
Мы также позаботились о том, чтобы у пользователя была возможность отслеживать недетерминированный доступ к содержимому: при нажатии на кнопку <ins>Проверить целостность</ins> происходит переход на страничку <ins>checker.html</ins>, где можно указать номер интересующей ячейки. Содержимое ячейки мы отслеживаем с помощью УЗ-датчиков HC-SR04, их показания отправляются методом POST, с помощью [get_sensors.php](https://github.com/qpq11/medical-closet/blob/main/get_sensors.php) вставляются в таблицу <ins>sensor_data</ins>. В PHP скрипте постоянно происходит сравнение показаний каждого датчика с предыдущими, и если наблюдаются различия в течение некоторого промежутка времени, при проверке появляется pop-up уведомление о том, что содержимое было удалено.
Имеется датчик, который периодически снимает информацию о температуре окружающей среды и подает сигнал при превышении допустимой для хранения содержимого температуры; текущее значение температуры выводится на экран. 
Мы добавили возможность отслеживать просроченные лекарства: если в базе данных обнаружено такое (сроки годности лекарств отслеживаются с помощью [api.php](https://github.com/qpq11/medical-closet/blob/main/api.php)), то светодиод в соответствующей ячейке мигает. Если затем его извлекут (осознанно удалят из таблицы), то светодиод перестанет мигать. 

При разработке плат использовался KiCad (...)

Корпус с дверцей были спроектированы в SolidWorks ([корпус](), [дверца](https://github.com/qpq11/medical-closet/blob/main/%D0%94%D0%B5%D1%82%D0%B0%D0%BB%D0%B8%20%D1%88%D0%BA%D0%B0%D1%84%D0%B0/%D0%94%D0%92%D0%95%D0%A0%D0%A6%D0%90/%D0%B4%D0%B2%D0%B5%D1%80%D1%86%D0%B0.SLDPRT)), затем каждая грань была сохранена в формате cdr и вырезана на лазере из фанеры или акрила.
## Компоненты, использованные инструменты/машины
### Компонетны:
* датчики УЗ HC-SR04
* датчик температуры 18B20 в корпусе
* микроконтроллер ESP-WROOM-32
* дисплей HW-069
* 3 светодиода
* 3 резистора 240 Ом
* сканер штрих кодов
## Используемые машины:
* лазер
* штука для резки плат
## Возникшие проблемы
* Первоначально мы пытались подключаться к бд напрямую, без http. При таком подходе установления TCP соединения не происходило.
* Поведение скриптов PHP для нас было достаточно непривычным: даже при малейшей ошибке в синтексисе мы получали <ins>ошибку 500</ins>, поначалу было трудно причину возникновения, так как логи нам показались не всегда лостаточно инфомативными.
* Дорожки на сделанной нами плате была слишком узкие, контактные площадки слишком маленькие, паять такие платы было тяжело, поэтому где-то мы устроили кз и сожгли микроконтроллер. Из-за этого и нехватки времени пришлось брать макетную плату.
* Периодически виртуальная машина "засыпает" и перестаёт отправлять DHCP-серверу запросы на выдачу ip в локальной сети. Статическим выделением ip эту проблему исправить не удалось: через некотрое время после такого сервер упал.
## Фото устройства
![20250512_110507](https://github.com/user-attachments/assets/b755d45a-1ad6-4cde-874b-d0a017a1343f)
## Демонстрация работы

